<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Peds Shift Intake</title>
  <meta name="description" content="Clinical calculator: kcal/kg per shift from total volume, shift duration, and weight." />
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --accent:#2563eb;
      --good:#16a34a;
      --warn:#d97706;
      --bad:#dc2626;
      --shadow: 0 8px 24px rgba(15,23,42,.08);
      --radius:12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg);
      color:var(--text);
      line-height:1.4;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:28px 16px 40px;
    }
    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
      margin-bottom:16px;
    }
    h1{
      margin:0;
      font-size:18px;
      font-weight:780;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      color:var(--muted);
      font-size:13px;
      max-width:720px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:7px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
      box-shadow: 0 2px 10px rgba(15,23,42,.04);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:99px;background:var(--accent);
    }

    main{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 860px){
      main{grid-template-columns:1fr}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:13px;
      font-weight:800;
      color:#111827;
      letter-spacing:.2px;
      text-transform:none;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .grid{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
    }
    input, select{
      width:100%;
      padding:10px 11px;
      border:1px solid var(--line);
      border-radius:10px;
      font-size:14px;
      color:var(--text);
      background:#fff;
      outline:none;
    }
    input:focus, select:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 3px rgba(37,99,235,.12);
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      cursor:pointer;
      border:1px solid rgba(37,99,235,.35);
      background:rgba(37,99,235,.08);
      color:var(--text);
      padding:9px 12px;
      border-radius:10px;
      font-weight:750;
      font-size:13px;
      user-select:none;
    }
    .btn:hover{ background:rgba(37,99,235,.11); }
    .btn:active{ transform:translateY(1px); }
    .btn.secondary{
      border-color:var(--line);
      background:#f8fafc;
      color:var(--muted);
      font-weight:700;
    }
    .mono{ font-family:var(--mono); }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .stats{grid-template-columns:1fr}
    }
    .stat{
      padding:11px;
      border:1px solid var(--line);
      border-radius:10px;
      background:#fbfdff;
    }
    .k{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .v{
      font-size:18px;
      font-weight:820;
      letter-spacing:.2px;
    }
    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      white-space:nowrap;
    }

    .score{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:10px;
      padding:11px;
      background:#fff;
    }
    .scoreline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .status{
      font-weight:800;
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:#fff;
      white-space:nowrap;
    }
    .status.good{ color:var(--good); border-color: rgba(22,163,74,.25); background: rgba(22,163,74,.06); }
    .status.warn{ color:var(--warn); border-color: rgba(217,119,6,.25); background: rgba(217,119,6,.06); }
    .status.bad{  color:var(--bad);  border-color: rgba(220,38,38,.25); background: rgba(220,38,38,.06); }

    .bar{
      width:100%;
      height:10px;
      border-radius:999px;
      background:#eef2f7;
      overflow:hidden;
      border:1px solid var(--line);
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(22,163,74,.95), rgba(37,99,235,.9));
      transition:width .2s ease;
    }
    .note{
      margin-top:9px;
      color:var(--muted);
      font-size:13px;
    }

    details{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:10px;
      background:#fff;
      padding:9px 11px;
    }
    summary{
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      color:#111827;
    }
    .small{
      color:var(--muted);
      font-size:12px;
      margin-top:8px;
    }
    .small ul{ margin:8px 0 0 18px; padding:0; }
    .small li{ margin:6px 0; }

    footer{
      margin-top:18px;
      padding-top:14px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:center;
    }
    footer a{
      color:var(--muted);
      text-decoration:none;
      font-weight:750;
    }
    footer a:hover{ color:var(--accent); text-decoration:underline; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Peds shift intake</h1>
        <div class="sub">
          Enter total volume, shift duration, and weight. Outputs <span class="mono">kcal/kg/shift</span> and an extrapolated <span class="mono">kcal/kg/day</span>.
        </div>
      </div>
      <div class="pill" title="Runs locally in your browser. No data storage.">
        <span class="dot"></span> offline
      </div>
    </header>

    <main>
      <section class="card">
        <h2>Inputs</h2>

        <div class="grid">
          <div>
            <label for="weightKg">Weight, kg</label>
            <input id="weightKg" inputmode="decimal" placeholder="10.2" />
          </div>

          <div>
            <label for="shiftHours">Shift, hours</label>
            <input id="shiftHours" inputmode="decimal" placeholder="12" />
          </div>

          <div>
            <label for="volumeMl">Total volume, mL</label>
            <input id="volumeMl" inputmode="decimal" placeholder="650" />
          </div>

          <div>
            <label for="kcalPerMl">Energy density</label>
            <select id="kcalPerMl">
              <option value="0.67" selected>Human milk</option>
              <option value="0.70">22 kcal/oz</option>
              <option value="0.80">24 kcal/oz</option>
              <option value="1.00">30 kcal/oz</option>
            </select>
          </div>

          <div>
            <label for="goalPreset">Goal, kcal/kg/day</label>
            <select id="goalPreset">
              <option value="100" selected>Infant 100</option>
              <option value="90">Older infant 90</option>
              <option value="80">Child 80</option>
              <option value="120">Catch-up 120</option>
              <option value="custom">Custom</option>
            </select>
          </div>

          <div>
            <label for="goalCustom">Custom goal</label>
            <input id="goalCustom" inputmode="decimal" placeholder="e.g., 110" disabled />
          </div>
        </div>

        <div class="row">
          <button class="btn" id="calcBtn">Calculate</button>
          <button class="btn secondary" id="clearBtn">Clear</button>
        </div>

        <details>
          <summary>Notes</summary>
          <div class="small">
            <ul>
              <li>Human milk modeled as <span class="mono">0.67 kcal/mL</span>.</li>
              <li>Use shift totals as documented in the EMR.</li>
              <li>Interpret with weight trend, UOP, emesis/diarrhea, and labs.</li>
            </ul>
          </div>
        </details>
      </section>

      <section class="card">
        <h2>Results</h2>

        <div class="stats">
          <div class="stat">
            <div class="k">Total kcal <span class="tag">shift</span></div>
            <div class="v" id="outKcal">—</div>
          </div>

          <div class="stat">
            <div class="k">kcal/kg <span class="tag">shift</span></div>
            <div class="v" id="outKcalKgShift">—</div>
          </div>

          <div class="stat">
            <div class="k">kcal/kg <span class="tag">day</span></div>
            <div class="v" id="outKcalKgDay">—</div>
          </div>

          <div class="stat">
            <div class="k">mL/kg <span class="tag">shift</span></div>
            <div class="v" id="outMlKgShift">—</div>
          </div>
        </div>

        <div class="score" aria-live="polite">
          <div class="scoreline">
            <div style="font-weight:820;color:#111827;font-size:13px;">Goal</div>
            <span id="statusChip" class="status">—</span>
          </div>
          <div class="bar"><div id="goalFill" class="fill"></div></div>
          <div class="note" id="interpretation">Enter inputs and calculate.</div>
        </div>

        <details>
          <summary>Targets</summary>
          <div class="small">
            <ul>
              <li>Infant: 100–120 kcal/kg/day</li>
              <li>Older infant: 90–100 kcal/kg/day</li>
              <li>Child maintenance: 80–90 kcal/kg/day</li>
              <li>Catch-up: 110–130 kcal/kg/day</li>
            </ul>
          </div>
        </details>
      </section>
    </main>

    <footer>
      <div>
        <a href="https://robbiemed.org" target="_blank" rel="noopener">made by robbie.med</a>
        &nbsp;| |&nbsp;
        <a href="mailto:talk@robbiemed.org">get in contact</a>
        &nbsp;A.D. 2025, S.D.G.
      </div>
    </footer>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const weightKg = $("weightKg");
    const shiftHours = $("shiftHours");
    const volumeMl = $("volumeMl");
    const kcalPerMl = $("kcalPerMl");
    const goalPreset = $("goalPreset");
    const goalCustom = $("goalCustom");

    const outKcal = $("outKcal");
    const outKcalKgShift = $("outKcalKgShift");
    const outKcalKgDay = $("outKcalKgDay");
    const outMlKgShift = $("outMlKgShift");

    const statusChip = $("statusChip");
    const goalFill = $("goalFill");
    const interpretation = $("interpretation");

    function toNum(x){
      const n = Number(String(x).trim());
      return Number.isFinite(n) ? n : NaN;
    }

    function fmt(n, digits=1){
      if (!Number.isFinite(n)) return "—";
      return n.toFixed(digits);
    }

    function getGoal(){
      if (goalPreset.value === "custom") return toNum(goalCustom.value);
      return toNum(goalPreset.value);
    }

    function setStatus(kind, text){
      statusChip.className = "status " + (kind || "");
      statusChip.textContent = text || "—";
    }

    function clearOutputs(){
      outKcal.textContent = "—";
      outKcalKgShift.textContent = "—";
      outKcalKgDay.textContent = "—";
      outMlKgShift.textContent = "—";
      goalFill.style.width = "0%";
      setStatus("", "—");
      interpretation.textContent = "Enter inputs and calculate.";
    }

    function updateCustom(){
      const isCustom = goalPreset.value === "custom";
      goalCustom.disabled = !isCustom;
      if (!isCustom) goalCustom.value = "";
    }

    function calc(){
      const w = toNum(weightKg.value);
      const hrs = toNum(shiftHours.value);
      const vol = toNum(volumeMl.value);
      const dens = toNum(kcalPerMl.value);
      const goal = getGoal();

      const errs = [];
      if (!(w > 0)) errs.push("Weight");
      if (!(hrs > 0 && hrs <= 24)) errs.push("Shift");
      if (!(vol >= 0)) errs.push("Volume");
      if (!(dens > 0)) errs.push("Density");
      if (!(goal > 0)) errs.push("Goal");

      if (errs.length){
        clearOutputs();
        setStatus("bad", "Check inputs");
        interpretation.textContent = "Missing or invalid: " + errs.join(", ") + ".";
        return;
      }

      const totalKcal = vol * dens;
      const kcalKgShift = totalKcal / w;
      const kcalKgDay = kcalKgShift * (24 / hrs);
      const mlKgShift = vol / w;

      outKcal.textContent = fmt(totalKcal, 0);
      outKcalKgShift.textContent = fmt(kcalKgShift, 1);
      outKcalKgDay.textContent = fmt(kcalKgDay, 0);
      outMlKgShift.textContent = fmt(mlKgShift, 1);

      const pct = (kcalKgDay / goal) * 100;
      const barPct = Math.max(0, Math.min(140, pct));
      goalFill.style.width = barPct + "%";

      let kind = "good", label = "On target";
      if (pct < 70){ kind = "bad"; label = "Low"; }
      else if (pct < 90){ kind = "warn"; label = "Borderline"; }

      setStatus(kind, label);

      if (pct < 70){
        interpretation.textContent = "Below goal. Recheck transfer, losses, and consider supplementation plan.";
      } else if (pct < 90){
        interpretation.textContent = "Near goal. Trend weight and I/Os; adjust if trajectory is off.";
      } else {
        interpretation.textContent = "Meets goal. Correlate with clinical course and weight trend.";
      }
    }

    $("calcBtn").addEventListener("click", calc);
    $("clearBtn").addEventListener("click", () => {
      weightKg.value = "";
      shiftHours.value = "";
      volumeMl.value = "";
      kcalPerMl.value = "0.67";
      goalPreset.value = "100";
      goalCustom.value = "";
      goalCustom.disabled = true;
      clearOutputs();
    });

    goalPreset.addEventListener("change", () => { updateCustom(); calc(); });

    [weightKg, shiftHours, volumeMl, kcalPerMl, goalCustom].forEach(el => {
      el.addEventListener("keydown", (e) => { if (e.key === "Enter") calc(); });
      el.addEventListener("input", () => {
        const any = [weightKg.value, shiftHours.value, volumeMl.value].some(v => String(v).trim().length > 0);
        if (any) calc();
      });
    });

    updateCustom();
    clearOutputs();
  </script>
</body>
</html>
